WARNING:tensorflow:From D:\RaihanFarid\Dokumen\faceRecog\.venv\Lib\site-packages\tf_keras\src\losses.py:2976: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.


============================================================
≡ƒûÑ∩╕Å  SYSTEM INFORMATION
============================================================
≡ƒÆ╗ CPU Cores: 12
≡ƒÆ╛ Total RAM: 7.7 GB
≡ƒÄ« GPU: No CUDA devices available
≡ƒÉì Python Version: 3.12.11
≡ƒöÑ PyTorch Version: 2.9.1+cpu
≡ƒæü∩╕Å  OpenCV Version: 4.13.0
≡ƒöº ONNX Runtime Version: 1.23.2
============================================================

≡ƒöì Checking GPU availability...
ΓÜá∩╕Å  CUDA not available, falling back to CPU
≡ƒöº Available ONNX Providers: ['AzureExecutionProvider', 'CPUExecutionProvider']
ΓÜá∩╕Å  ONNX CUDA Execution Provider not available
≡ƒöä Using default multi-source configuration

≡ƒÄ» MULTI-SOURCE CONFIGURATION
==================================================
≡ƒô╣ 6:
   URL: 0
   Description: Main Camera
   Priority: medium
   CCTV Name: None
   Processing Scale: 1
==================================================

≡ƒöì Testing multi-stream connections for 1 sources...

≡ƒô╣ Testing source: 6
≡ƒÄ¼ StreamManager initialized with robust reconnection handling
≡ƒöì Initializing camera stream: 0
≡ƒô╖ Attempting to open camera 0 with backend 700
Γ£à Camera 0 opened successfully
Γ¥ñ∩╕Å  Stream health monitor started
≡ƒôè Stream Info:
   Type: camera
   Resolution: 640x480
   FPS: 30.0
   Source: 0
Γ£à Stream initialized successfully: 0
   Γ£à Frame 1: (480, 640, 3)
   Γ£à Frame 2: (480, 640, 3)
   Γ£à Frame 3: (480, 640, 3)
Γ£à Source 6 test successful
≡ƒö┤ Releasing StreamManager...
≡ƒö┤ StreamManager released

≡ƒôè STREAM TEST SUMMARY:
   Γ£à Successful: 1 sources
   Γ¥î Failed: 0 sources
≡ƒö┤ Releasing StreamManager...
≡ƒö┤ StreamManager released

≡ƒöä Creating face recognition system...
Γ£à ConfigManager initialized with unified configuration system
ΓÜá∩╕Å  Config for 'robust' not found, using base config

≡ƒöì Verifying GPU usage...
≡ƒÄ» YOLO Model Device: cpu
≡ƒÄ» ONNX Mask Detector Providers: ['CPUExecutionProvider']
≡ƒÄ» DeepFace Backend: Could not determine
≡ƒÄ» PerformanceManager initialized with momentum-based historical scaling
   - Scale range: 0.50 to 3.00
   - Cooldown range: 2.0s to 10.0s
ΓÜÖ∩╕Å BaseProcessor initialized with mandatory performance-managed scaling
≡ƒÄ» Initial scale: 1.00 (from PerformanceManager)
≡ƒÄ» PerformanceManager initialized with momentum-based historical scaling
   - Scale range: 0.50 to 3.00
   - Cooldown range: 2.0s to 10.0s
≡ƒöè Duration-aware batch alerts: 1 frames threshold
   Batch logic: window=5s, min=2
≡ƒÄ» MultiSourceRealTimeProcessor initialized with enhanced thread safety
≡ƒöè Alert config updated with batch logic
   Batch: window=5s, min=2
   Names: max=4
≡ƒöè Audio alert system configured
≡ƒÄ» Face tracking system configured for all sources
≡ƒôñ Server push configured for 0 sources
≡ƒôè Multi-source logging system configured
Γ£à Violation verification configured: enabled=True

============================================================
≡ƒÄ» MULTI-SOURCE SYSTEM CONFIGURATION STATUS
============================================================
≡ƒôè Sources: 1 cameras configured
≡ƒöì Detection: Confidence=0.5, Recognition Threshold=0.8
≡ƒÄ» Face Tracking: ENABLED
Γ£à Violation Verification: ENABLED
   - Min Duration: 1s
   - Min Frames: 1
   - Confidence Threshold: 0.15
≡ƒô¥ Logging: ENABLED
≡ƒöè Alerts: ENABLED
≡ƒôñ Server Push: ENABLED
≡ƒÉ¢ Debug: DISABLED
≡ƒû╝∩╕Å  Display Layout: grid
≡ƒÄ« GPU Acceleration: DISABLED
============================================================

≡ƒôñ SERVER PUSH CONFIGURATION
========================================
   Endpoint: https://vps.casda.my.id/accounting/public/api/submit_ai_detection
   Cooldown: 5s
   Timeout: 10s
   Retry Attempts: 10
   CCTV Name: Default
   JSON Structure:
     {
       "filename": "string",
       "image_format": "jpg",
       "image_data": "base64_string",
       "detected_name": "string",
       "cctv_name": "string"
     }
========================================

==================================================
≡ƒæñ MULTI-SOURCE TRACKING SYSTEM STATUS
==================================================
==================================================

==================================================
≡ƒöè AUDIO ALERT SYSTEM STATUS
==================================================
  enabled: True
  server_url: https://vps.casda.my.id/actions/a_notifikasi_suara_speaker.php
  cooldown_seconds: 15
  min_violation_frames: 1
  min_violation_seconds: 1
  max_gap_frames: 10
  alert_language: id
  alert_style: formal
  alert_timeout_seconds: 2
  max_names_in_alert: 4
  batch_window_seconds: 5
  min_batch_size: 2
  image_log_interval: 5
  min_save_interval: 1.0
  current_batch_size: 0
  batch_violators: []
==================================================
≡ƒû╝∩╕Å  Display size set to 1280x720 using fit_to_screen method

≡ƒöì FINAL SYSTEM READINESS CHECK
========================================
≡ƒô╣ Sources: 1 cameras ready
   - 6
≡ƒÄ« GPU: CPU MODE
≡ƒôñ Server Push: READY
≡ƒöè Audio Alerts: READY
≡ƒÄ» Tracking: READY
Γ£à Violation Verification: READY
========================================

≡ƒÄ« VERIFICATION CONTROLS:
   [V] - Toggle violation verification
   [S] - Show verification statistics
   [M] - Start verification monitoring

≡ƒÄ« MULTI-SOURCE CONTROLS:
   [m] - Cycle through display layouts (grid, horizontal, vertical)
   [n] - Toggle source health display
   [0] - Show source health report
   [l] - Toggle logging
   [v] - Toggle voice alerts
   [p] - Toggle performance stats
   [d] - Toggle debug mode
   [q] - Quit

ΓÅ│ Starting multi-source processing in 3 seconds...

≡ƒöì ENSURING IMAGE LOGGERS ARE CREATED FOR ALL SOURCES

≡ƒöì PRE-START CCTV NAME CHECK

≡ƒöì DEBUG CCTV NAME STATUS
==================================================
Active sources: []
Source configs: []
Image loggers: []
==================================================

≡ƒÄ» ADDING SOURCES WITH DYNAMIC CCTV NAMING
==================================================
≡ƒô╣ Adding source: 6
   ≡ƒöì CCTV name extraction test: Camera-0
≡ƒôü Stored configuration for 6
≡ƒöì Final config keys for 6: ['url', 'description', 'priority', 'processing_scale', 'buffer_size', 'cctv_name', 'detection_model_path', 'embeddings_db_path', 'mask_model_path', 'detection_confidence', 'recognition_threshold', 'mask_detection_threshold', 'detection_iou', 'min_face_size', 'max_faces_per_frame', 'enable_person_detection', 'person_detection_confidence_threshold', 'display_layout', 'max_display_sources', 'processing_width', 'processing_height', 'maintenance_interval', 'violation_verification_enabled', 'min_violation_duration', 'min_violation_frames', 'violation_confidence_threshold', 'log_interval', 'enable_logging', 'enable_image_logging', 'image_log_interval', 'max_images_per_session', 'min_save_interval', 'server_push_enabled', 'server_endpoint', 'server_push_cooldown', 'server_timeout', 'server_retry_attempts', 'server_retry_delay', 'enable_image_resize', 'image_resize_width', 'image_resize_height', 'image_resize_method', 'enable_voice_alerts', 'alert_server_url', 'alert_cooldown_seconds', 'min_violation_seconds', 'max_gap_frames', 'alert_language', 'alert_style', 'enable_individual_alerts', 'enable_group_alerts', 'alert_timeout_seconds', 'alert_verification_required', 'min_alert_confidence', 'alert_buffer_size', 'enable_multi_scale', 'enable_temporal_fusion', 'enable_quality_aware', 'embedding_model', 'enable_base64_logging', 'base64_quality', 'headless_mode', 'use_gpu', 'gpu_device', 'annotation_box_thickness', 'annotation_text_thickness', 'annotation_min_text_scale', 'annotation_max_text_scale']
≡ƒÄ¼ StreamManager initialized with robust reconnection handling
≡ƒöì Initializing camera stream: 0
≡ƒô╖ Attempting to open camera 0 with backend 700
Γ£à Camera 0 opened successfully
Γ¥ñ∩╕Å  Stream health monitor started
≡ƒôè Stream Info:
   Type: camera
   Resolution: 640x480
   FPS: 30.0
   Source: 0
Γ£à Stream initialized successfully: 0
≡ƒîÉ Global tracking config available: True
2026-01-21 13:35:08,560 - face_recog_modular2.tracking.progressive_mask_detector - INFO - Enhanced Progressive Mask Detector initialized
2026-01-21 13:35:08,560 - face_recog_modular2.tracking.progressive_mask_detector - INFO -   State holding duration: 15.0s
2026-01-21 13:35:08,560 - face_recog_modular2.tracking.progressive_mask_detector - INFO -   Minimum stability to commit: 0.15
2026-01-21 13:35:08,560 - face_recog_modular2.tracking.progressive_mask_detector - INFO -   Adaptive label weighting enabled
2026-01-21 13:35:08,560 - face_recog_modular2.tracking.tracking_manager - INFO - Policy Thresholds - min_violation_frames: 1, min_violation_duration: 1s
2026-01-21 13:35:08,561 - face_recog_modular2.tracking.tracking_manager - INFO - Simplified TrackingManager initialized
≡ƒÄ» FINAL Tracking configuration for 6:
   Total keys in tracking_config: 23
   Progressive mask enabled: True
   Progressive mask parameters: 20
     mask_buffer_size: 200
     min_mask_frames: 2
     mask_confidence_threshold: 0.1
≡ƒöº [TrackingManager] Received config with keys: ['enabled', 'fairness_enabled', 'confidence_frames', 'cooldown_seconds', 'min_iou', 'max_recognitions_per_person', 'recent_window_size', 'enable_velocity_prediction', 'enable_appearance_matching', 'max_track_age', 'enable_person_tracking', 'person_track_confidence', 'person_track_max_age', 'person_iou_threshold', 'bytetrack_track_thresh', 'bytetrack_track_buffer', 'bytetrack_match_thresh', 'bytetrack_min_box_area', 'progressive_mask', 'violation_verification_enabled', 'min_violation_duration', 'min_violation_frames', 'violation_confidence_threshold']
ΓÜá∩╕Å  Config appears to be tracking config itself, using as tracking_config
≡ƒöº [TrackingManager] Tracking config: ['enabled', 'fairness_enabled', 'confidence_frames', 'cooldown_seconds', 'min_iou', 'max_recognitions_per_person', 'recent_window_size', 'enable_velocity_prediction', 'enable_appearance_matching', 'max_track_age', 'enable_person_tracking', 'person_track_confidence', 'person_track_max_age', 'person_iou_threshold', 'bytetrack_track_thresh', 'bytetrack_track_buffer', 'bytetrack_match_thresh', 'bytetrack_min_box_area', 'progressive_mask', 'violation_verification_enabled', 'min_violation_duration', 'min_violation_frames', 'violation_confidence_threshold']
Γ£à Found progressive_mask at root level
≡ƒöº [TrackingManager] Passing to ProgressiveMaskDetector:
   Config: {'mask_buffer_size': 200, 'min_mask_frames': 2, 'occlusion_timeout': 3.0, 'mask_confidence_threshold': 0.1, 'mask_consistency_threshold': 0.1, 'min_stability_to_commit': 0.15, 'state_hold_duration': 15.0, 'verification_grace_ratio': 0.1, 'spatial_consistency_weight': 0.3, 'max_bbox_variation': 0.45, 'extreme_confidence_threshold': 0.95, 'extreme_mask_penalty': 0.8, 'extreme_no_mask_boost': 0.9, 'initial_mask_weight': 0.5, 'initial_no_mask_weight': 0.5, 'weight_increase_high_conf': 0.4, 'weight_decrease_low_conf': 0.3, 'weight_increase_opposite': 0.1, 'confidence_smoothing_factor': 0.3, 'stability_smoothing_factor': 0.2}
   Keys: ['mask_buffer_size', 'min_mask_frames', 'occlusion_timeout', 'mask_confidence_threshold', 'mask_consistency_threshold', 'min_stability_to_commit', 'state_hold_duration', 'verification_grace_ratio', 'spatial_consistency_weight', 'max_bbox_variation', 'extreme_confidence_threshold', 'extreme_mask_penalty', 'extreme_no_mask_boost', 'initial_mask_weight', 'initial_no_mask_weight', 'weight_increase_high_conf', 'weight_decrease_low_conf', 'weight_increase_opposite', 'confidence_smoothing_factor', 'stability_smoothing_factor']
≡ƒÄÑ Capture thread started
≡ƒÄ¼ Frame capture started
Γ£à Added source: 6
Γ£à Successfully added 6 ΓåÆ Local-Camera-0
==================================================

============================================================
≡ƒôè ALL ACTIVE SOURCES INFORMATION
============================================================

≡ƒô╣ 6:
   ≡ƒöù URL: 0
   ≡ƒÅ╖∩╕Å  CCTV Name: Local-Camera-0
   ≡ƒô¥ Description: Main Camera
   ΓÜí Active: True
   ≡ƒÄ» Tracking: True
   ≡ƒû╝∩╕Å  Logging: False
   ΓÜÖ∩╕Å  Processing Scale: 1
   ≡ƒôê FPS: 0.0
============================================================

==================================================
≡ƒô╣ CCTV NAME MAPPING
==================================================
  ≡ƒƒó 6 ΓåÆ Local-Camera-0 Γ¥î
==================================================

≡ƒöä Setting up multi-source logging with dynamic CCTV names...
≡ƒôü Setting up multi-source logging session: multi_source_20260121_133508

≡ƒöì DEBUG CCTV NAME STATUS
==================================================
Active sources: ['6']
Source configs: ['6']
Image loggers: []

≡ƒô╣ Source: 6
   Cached CCTV Name: Local-Camera-0
   ImageLogger: Γ¥î NOT CREATED
==================================================
≡ƒöä Set dynamic CCTV name for 6: Local-Camera-0
≡ƒöì Creating ImageLogger for 6 with CCTV name: Local-Camera-0
≡ƒô╣ ImageLogger initialized with CCTV name: Local-Camera-0
≡ƒöì Setting up ImageLogger with base filename: multi_source_20260121_133508_Local-Camera-0
Γ£à ImageLogger setup for source: 6 ΓåÆ Local-Camera-0
≡ƒöì Verification - ImageLogger CCTV name: Local-Camera-0
≡ƒöì Verification - ImageLogger folder: multi_source_20260121_133508_Local-Camera-0_images
≡ƒû╝∩╕Å  Multi-source image logging ENABLED for 1 sources

==================================================
≡ƒô╣ CCTV NAME MAPPING
==================================================
  ≡ƒƒó 6 ΓåÆ Local-Camera-0 ≡ƒû╝∩╕Å
==================================================

≡ƒöì DEBUG CCTV NAME STATUS
==================================================
Active sources: ['6']
Source configs: ['6']
Image loggers: ['6']

≡ƒô╣ Source: 6
   Cached CCTV Name: Local-Camera-0
   ImageLogger CCTV: Local-Camera-0
   ImageLogger Enabled: True
   Match: Γ£à
==================================================
Γ£à Multi-source specific configuration applied
≡ƒÄ¼ Starting stabilized multi-source processing with None sources
≡ƒÅÑ Health monitoring started
≡ƒº╣ Periodic maintenance started
≡ƒöì [1-FACE-SYSTEM] 1 raw detections
    Raw 0: bbox=[257, 239, 361, 382], mask='no_mask', conf=0.6923502087593079
    Raw 0: bbox=[257, 239, 361, 382], identity='None', mask='no_mask'
≡ƒöì [2-TO-TRACKER] Sending 1 results to tracker
Γ£à Result 0: Progressive data exists - status=no_mask, progress=0.00, frames=0
≡ƒôè Progressive data coverage: 1/1 results
≡ƒöì [3-TRACKER-RESULTS] 1 processed results
    Tracked 0: identity='None', verified=False, hidden=False
≡ƒöì [1-FACE-SYSTEM] 1 raw detections
    Raw 0: bbox=[257, 239, 361, 383], mask='no_mask', conf=0.8672581315040588
    Raw 0: bbox=[257, 239, 361, 383], identity='None', mask='no_mask'
≡ƒöì [2-TO-TRACKER] Sending 1 results to tracker
Γ£à Result 0: Progressive data exists - status=no_mask, progress=0.00, frames=0
≡ƒôè Progressive data coverage: 1/1 results
≡ƒöì [3-TRACKER-RESULTS] 1 processed results
    Tracked 0: identity='None', verified=False, hidden=False
≡ƒöì [1-FACE-SYSTEM] 1 raw detections
    Raw 0: bbox=[258, 238, 362, 385], mask='no_mask', conf=0.9498683214187622
    Raw 0: bbox=[258, 238, 362, 385], identity='None', mask='no_mask'
≡ƒöì [2-TO-TRACKER] Sending 1 results to tracker
Γ£à Result 0: Progressive data exists - status=no_mask, progress=0.00, frames=0
≡ƒôè Progressive data coverage: 1/1 results
≡ƒöì [3-TRACKER-RESULTS] 1 processed results
    Tracked 0: identity='None', verified=False, hidden=False
≡ƒöì [1-FACE-SYSTEM] 1 raw detections
    Raw 0: bbox=[257, 239, 361, 384], mask='no_mask', conf=0.9873331785202026
    Raw 0: bbox=[257, 239, 361, 384], identity='None', mask='no_mask'
≡ƒöì [2-TO-TRACKER] Sending 1 results to tracker
Γ£à Result 0: Progressive data exists - status=no_mask, progress=0.00, frames=0
≡ƒôè Progressive data coverage: 1/1 results
≡ƒöì [3-TRACKER-RESULTS] 1 processed results
    Tracked 0: identity='None', verified=False, hidden=False
≡ƒöì [1-FACE-SYSTEM] 1 raw detections
    Raw 0: bbox=[258, 239, 362, 384], mask='no_mask', conf=0.9913426637649536
    Raw 0: bbox=[258, 239, 362, 384], identity='None', mask='no_mask'
≡ƒöì [2-TO-TRACKER] Sending 1 results to tracker
Γ£à Result 0: Progressive data exists - status=no_mask, progress=0.00, frames=0
≡ƒôè Progressive data coverage: 1/1 results
≡ƒöì [3-TRACKER-RESULTS] 1 processed results
    Tracked 0: identity='None', verified=False, hidden=False
≡ƒöì [1-FACE-SYSTEM] 1 raw detections
    Raw 0: bbox=[258, 238, 362, 383], mask='no_mask', conf=0.9915071725845337
    Raw 0: bbox=[258, 238, 362, 383], identity='None', mask='no_mask'
≡ƒöì [2-TO-TRACKER] Sending 1 results to tracker
Γ£à Result 0: Progressive data exists - status=no_mask, progress=0.00, frames=0
≡ƒôè Progressive data coverage: 1/1 results
≡ƒöì [3-TRACKER-RESULTS] 1 processed results
    Tracked 0: identity='None', verified=False, hidden=False
≡ƒöì [1-FACE-SYSTEM] 1 raw detections
    Raw 0: bbox=[258, 240, 362, 383], mask='no_mask', conf=0.9947108030319214
    Raw 0: bbox=[258, 240, 362, 383], identity='None', mask='no_mask'
≡ƒöì [2-TO-TRACKER] Sending 1 results to tracker
Γ£à Result 0: Progressive data exists - status=no_mask, progress=0.00, frames=0
≡ƒôè Progressive data coverage: 1/1 results
≡ƒöì [3-TRACKER-RESULTS] 1 processed results
    Tracked 0: identity='None', verified=False, hidden=False
≡ƒöì [1-FACE-SYSTEM] 1 raw detections
    Raw 0: bbox=[259, 239, 361, 380], mask='no_mask', conf=0.9950301647186279
    Raw 0: bbox=[259, 239, 361, 380], identity='None', mask='no_mask'
≡ƒöì [2-TO-TRACKER] Sending 1 results to tracker
Γ£à Result 0: Progressive data exists - status=no_mask, progress=0.00, frames=0
≡ƒôè Progressive data coverage: 1/1 results
≡ƒöì [3-TRACKER-RESULTS] 1 processed results
    Tracked 0: identity='None', verified=False, hidden=False
≡ƒöì [1-FACE-SYSTEM] 1 raw detections
    Raw 0: bbox=[258, 239, 362, 379], mask='no_mask', conf=0.9942805767059326
    Raw 0: bbox=[258, 239, 362, 379], identity='None', mask='no_mask'
≡ƒöì [2-TO-TRACKER] Sending 1 results to tracker
Γ£à Result 0: Progressive data exists - status=no_mask, progress=0.00, frames=0
≡ƒôè Progressive data coverage: 1/1 results
≡ƒöì [3-TRACKER-RESULTS] 1 processed results
    Tracked 0: identity='None', verified=False, hidden=False
≡ƒöì [1-FACE-SYSTEM] 1 raw detections
    Raw 0: bbox=[259, 239, 362, 379], mask='no_mask', conf=0.9965968728065491
    Raw 0: bbox=[259, 239, 362, 379], identity='None', mask='no_mask'
≡ƒöì [2-TO-TRACKER] Sending 1 results to tracker
Γ£à Result 0: Progressive data exists - status=no_mask, progress=0.00, frames=0
≡ƒôè Progressive data coverage: 1/1 results
≡ƒöì [3-TRACKER-RESULTS] 1 processed results
    Tracked 0: identity='None', verified=False, hidden=False
≡ƒöì [1-FACE-SYSTEM] 2 raw detections
    Raw 0: bbox=[258, 239, 362, 380], mask='no_mask', conf=0.9970236420631409
    Raw 0: bbox=[258, 239, 362, 380], identity='None', mask='no_mask'
    Raw 1: bbox=[583, 240, 593, 253], mask='mask', conf=0.9978320002555847
    Raw 1: bbox=[583, 240, 593, 253], identity='None', mask='mask'
≡ƒöì [2-TO-TRACKER] Sending 2 results to tracker
Γ£à Result 0: Progressive data exists - status=no_mask, progress=0.00, frames=0
Γ£à Result 1: Progressive data exists - status=mask, progress=0.00, frames=0
≡ƒôè Progressive data coverage: 2/2 results
≡ƒöì [3-TRACKER-RESULTS] 2 processed results
    Tracked 0: identity='None', verified=False, hidden=False
    Tracked 1: identity='None', verified=False, hidden=False
≡ƒ¢æ Quitting...
≡ƒ¢æ Quitting application...
≡ƒ¢æ Processing loop ended
≡ƒº╣ Starting comprehensive resource cleanup...
ΓÅ│ Stopping health_monitor_thread...
ΓÜá∩╕Å health_monitor_thread did not stop gracefully
ΓÅ│ Stopping maintenance_thread...
ΓÜá∩╕Å maintenance_thread did not stop gracefully
≡ƒ¢æ Frame capture stopped
≡ƒö┤ Releasing StreamManager...
≡ƒö┤ StreamManager released
Γ£à Closed stream for 6
≡ƒö┤ Releasing StreamManager...
≡ƒö┤ StreamManager released
Γ£à Cleaned up tracker for 6
Γ£à Cleaned up logger for 6
≡ƒºá Garbage collection: 64 objects collected
≡ƒôè Memory usage: 968.78 MB
Γ£à Resource cleanup completed

≡ƒôè Starting verification performance monitoring...
≡ƒôè Started verification performance monitoring (interval: 60s)
≡ƒ¢æ Stopping all sources...
ΓÜá∩╕Å Already stopping or stopped
